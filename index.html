<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Undyne Clone</title>
  <style>
    body {
      margin: 0;
      background: black;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    canvas {
      border: 5px solid white;
      display: block;
      background: black;
    }
    #overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      color: white;
      font-size: 2em;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 10;
    }
  </style>
</head>
<body>
  <div id="overlay">Click to Start</div>
  <canvas id="gameCanvas" width="600" height="600"></canvas>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const overlay = document.getElementById('overlay');

    const assets = {
      soul: 'assets/SOUL.png',
      shield: 'assets/shield.png',
      arrow: 'assets/arrow.png',
      music: 'assets/music.mp3'
    };

    let soul = { x: canvas.width/2, y: canvas.height/2, size: 32 };
    let shieldPos = 'up'; // up, down, left, right
    let arrows = [];
    let arrowSpeed = 200;
    let score = 0;
    let highScore = parseInt(localStorage.getItem('highScore')) || 0;
    let wave = 1;
    let arrowsThisWave = 0;
    let gameOver = false;
    let lastTime = 0;
    let spawnCooldown = 1.5; // seconds between arrows
    let spawnTimer = 0;

    const soulImg = new Image();
    soulImg.src = assets.soul;
    const shieldImg = new Image();
    shieldImg.src = assets.shield;
    const arrowImg = new Image();
    arrowImg.src = assets.arrow;

    const music = new Audio(assets.music);
    music.loop = true;

    function resetGame(){
      arrows = [];
      arrowSpeed = 200;
      score = 0;
      wave = 1;
      arrowsThisWave = 0;
      gameOver = false;
    }

    function spawnArrow(){
      if(arrowsThisWave >= 10) return; // max 10 arrows per wave
      const sides = ['up','down','left','right'];
      const side = sides[Math.floor(Math.random()*4)];
      let arrow = {x:0,y:0,dx:0,dy:0,size:32};

      if(side==='up'){
        arrow.x = canvas.width/2;
        arrow.y = 0;
        arrow.dy = 1;
      } else if(side==='down'){
        arrow.x = canvas.width/2;
        arrow.y = canvas.height;
        arrow.dy = -1;
      } else if(side==='left'){
        arrow.x = 0;
        arrow.y = canvas.height/2;
        arrow.dx = 1;
      } else if(side==='right'){
        arrow.x = canvas.width;
        arrow.y = canvas.height/2;
        arrow.dx = -1;
      }

      arrows.push(arrow);
      arrowsThisWave++;

      if(arrowsThisWave === 10){
        // prepare next wave
        setTimeout(()=>{
          wave++;
          arrowsThisWave = 0;
          arrowSpeed += 25;
        }, 2000);
      }
    }

    function update(dt){
      if(gameOver) return;

      spawnTimer += dt;
      if(spawnTimer >= spawnCooldown && arrowsThisWave < 10){
        spawnArrow();
        spawnTimer = 0;
      }

      for(let i=arrows.length-1;i>=0;i--){
        let a = arrows[i];
        a.x += a.dx * arrowSpeed * dt;
        a.y += a.dy * arrowSpeed * dt;

        // Check collision with soul
        if(Math.abs(a.x - soul.x) < soul.size/2 && Math.abs(a.y - soul.y) < soul.size/2){
          if(
            (shieldPos==='up' && a.dy>0 && a.x===canvas.width/2) ||
            (shieldPos==='down' && a.dy<0 && a.x===canvas.width/2) ||
            (shieldPos==='left' && a.dx>0 && a.y===canvas.height/2) ||
            (shieldPos==='right' && a.dx<0 && a.y===canvas.height/2)
          ){
            // blocked
            arrows.splice(i,1);
            score++;
            if(score>highScore){
              highScore=score;
              localStorage.setItem('highScore',highScore);
            }
          } else {
            // game over
            gameOver = true;
            setTimeout(()=>{resetGame();},3000);
          }
        }
      }
    }

    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);

      if(!gameOver){
        ctx.drawImage(soulImg, soul.x - soul.size/2, soul.y - soul.size/2, soul.size, soul.size);
        let shieldX = soul.x;
        let shieldY = soul.y;
        const offset = 40;
        if(shieldPos==='up') shieldY -= offset;
        if(shieldPos==='down') shieldY += offset;
        if(shieldPos==='left') shieldX -= offset;
        if(shieldPos==='right') shieldX += offset;
        ctx.drawImage(shieldImg, shieldX-16, shieldY-16, 32, 32);

        for(let a of arrows){
          ctx.drawImage(arrowImg, a.x-16, a.y-16, a.size, a.size);
        }
      } else {
        ctx.fillStyle='white';
        ctx.font='48px sans-serif';
        ctx.textAlign='center';
        ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2);
      }

      // UI
      ctx.fillStyle='white';
      ctx.font='16px sans-serif';
      ctx.textAlign='left';
      ctx.fillText('Score: '+score,10,20);
      ctx.fillText('High Score: '+highScore,10,40);
      ctx.textAlign='right';
      ctx.fillText('Wave: '+wave, canvas.width-10, 20);
    }

    function gameLoop(timestamp){
      if(!lastTime) lastTime = timestamp;
      const dt = (timestamp - lastTime)/1000;
      lastTime = timestamp;

      update(dt);
      draw();
      requestAnimationFrame(gameLoop);
    }

    document.addEventListener('keydown', e=>{
      if(e.key==='ArrowUp') shieldPos='up';
      if(e.key==='ArrowDown') shieldPos='down';
      if(e.key==='ArrowLeft') shieldPos='left';
      if(e.key==='ArrowRight') shieldPos='right';
    });

    overlay.addEventListener('click',()=>{
      overlay.style.display='none';
      resetGame();
      music.play();
      requestAnimationFrame(gameLoop);
    });
  </script>
</body>
</html>
